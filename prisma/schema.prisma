// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["prismaSchemaFolder"]
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model User {
    id         Int      @id @default(autoincrement())
    name       String   @db.VarChar(255)
    email      String   @unique @db.VarChar(255)
    password   String   @db.VarChar(255)
    role       String   @db.VarChar(50) // admin or brand
    status     Int      @default(1) @db.TinyInt // 1 = active, 0 = inactive
    avatar_url String?  @db.VarChar(500)
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    @@map("users")
}

model Brand {
    id           Int      @id @default(autoincrement())
    name         String   @db.VarChar(255)
    logo_url     String?  @db.VarChar(500)
    status       Int      @default(1) @db.TinyInt // 1 = active, 0 = inactive
    descriptions String   @db.Text
    created_at   DateTime @default(now())
    updated_at   DateTime @updatedAt

    products Product[]

    @@map("brands")
}

model Product {
    id         Int      @id @default(autoincrement())
    code       String   @unique @db.VarChar(100)
    metadata   Json // Dynamic JSON containing all product info including images
    status     Int      @default(1) @db.TinyInt // 1 = active, 0 = inactive
    brand_id   Int
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    brand Brand @relation(fields: [brand_id], references: [id], onDelete: Cascade)

    @@index([brand_id])
    @@map("products")
}

model Tag {
    id             Int      @id @default(autoincrement())
    code           String   @unique @db.VarChar(100)
    product_ids    Json // Array of product IDs stored as JSON
    metadata       Json // Dynamic JSON metadata
    is_stamped     Int      @default(0) @db.TinyInt // 0 = not stamped, 1 = stamped to blockchain
    hash_tx        String?  @db.VarChar(255) // Generated hash from blockchain transaction
    publish_status Int      @default(0) @db.TinyInt // 0 = draft, 1 = published (internal app state)
    chain_status   Int?     @db.TinyInt // Blockchain lifecycle status (0-5: CREATED/DISTRIBUTED/CLAIMED/TRANSFERRED/FLAGGED/REVOKED)
    created_at     DateTime @default(now())
    updated_at     DateTime @updatedAt

    @@map("tags")
}
